services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    container_name: portfolio-os-backend
    ports:
      - '3200:3000'
    environment:
      NODE_ENV: ${NODE_ENV:-production}
      PORT: 3000
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      JWT_SECRET: ${JWT_SECRET}
      WEBHOOK_SECRET: ${WEBHOOK_SECRET}
      MASTER_SECRET: ${MASTER_SECRET}
      QDRANT_URL: http://qdrant:6333
      QDRANT_API_KEY: ${QDRANT_API_KEY:-}
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:-}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID:-}
      DISCORD_WEBHOOK_URL: ${DISCORD_WEBHOOK_URL:-}
      LOG_LEVEL: ${LOG_LEVEL:-info}
      ENABLE_TELEMETRY: ${ENABLE_TELEMETRY:-true}
      TRACK_QUERIES: ${TRACK_QUERIES:-true}
      MEDIUM_USERNAME: ${MEDIUM_USERNAME:-}
    volumes:
      - ./data:/data
      - ./logs:/app/logs
    depends_on:
      - qdrant
    restart: unless-stopped
    networks:
      - portfolio-net

  qdrant:
    image: qdrant/qdrant:latest
    container_name: portfolio-os-qdrant
    ports:
      - '6333:6333'
      - '6334:6334'
    environment:
      QDRANT_API_KEY: ${QDRANT_API_KEY:-}
    volumes:
      - qdrant-data:/qdrant/storage
    restart: unless-stopped
    networks:
      - portfolio-net

volumes:
  qdrant-data:

networks:
  portfolio-net:
    driver: bridge
